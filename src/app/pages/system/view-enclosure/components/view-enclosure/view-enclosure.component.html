<ng-template #pageHeader>
  <ix-page-title-header>
    <button *ngIf="views.length > 1 && controller?.isRackmount"
      mat-button ixTest="elements-menu"
      [matMenuTriggerFor]="elementsMenu"
    >
      {{ 'Elements' | translate }}
      <ix-icon name="mdi-menu-down" class="menu-caret"></ix-icon>
    </button>
    <mat-menu #elementsMenu="matMenu">
      <ng-container *ngIf="views.length">
        <button *ngFor="let view of views"
          mat-menu-item
          [ixTest]="view.alias"
          (click)="changeView(view)">
          <span>{{ view.alias | translate }}</span>
        </button>
      </ng-container>
    </mat-menu>
  </ix-page-title-header>
</ng-template>

<ng-container *ngIf="errors.length === 0">
  <!-- Loading indicators -->
  <div *ngIf="spinner" class="loader-dialog mat-mdc-card">
    <div class="loader-dialog-inner">
      <h3>Requesting </h3>
      <ul>
        <li class="spinner-data-type">
          <span class="td">enclosure data</span>
          <span class="td">
            <mat-spinner
              *ngIf="!systemState || systemState.areEnclosuresLoading"
              class="spinner indicator"
              [diameter]="22"></mat-spinner>
            <ix-icon
              *ngIf="systemState && !systemState.areEnclosuresLoading"
              name="mdi-check-circle"
              class="icon indicator"></ix-icon>
          </span>
        </li>
        <li class="spinner-data-type">
          <span class="td">disk data</span>
          <span class="td">
            <mat-spinner
              *ngIf="!systemState || systemState.areDisksLoading"
              class="spinner indicator"
              [diameter]="22"></mat-spinner>
            <ix-icon
              *ngIf="systemState && !systemState.areDisksLoading"
              name="mdi-check-circle"
              class="icon indicator"></ix-icon>
          </span>
        </li>
        <li class="spinner-data-type">
          <span class="td">pool data</span>
          <span class="td">
            <mat-spinner
              *ngIf="!systemState || systemState.arePoolsLoading"
              class="spinner indicator"
              [diameter]="22"></mat-spinner>
            <ix-icon
              *ngIf="systemState && !systemState.arePoolsLoading"
              name="mdi-check-circle"
              class="icon indicator"></ix-icon>
          </span>
        </li>
      </ul>

    </div>
  </div>

  <div
    *ngIf="systemState?.enclosures && !spinner && systemManufacturer && systemManufacturer === 'ixsystems'"
    class="page-viewport"
    fxLayout="row wrap"
  >
    <!-- Persistent Visualizer -->
    <div
      class="main-content"
      [fxFlex]="'calc(100% - ' + (systemState.enclosures.length * 240).toString() + 'px )'"
    >

      <ng-container *ngIf="controller && supportedHardware">
        <div
          *ngIf="controller?.isRackmount; else mini"
          class="enclosure-disks-wrapper"
        >
          <ix-enclosure-disks
            *ngIf="events"
            [controller-events]="events"
            [current-tab]="currentView"
            [profile]="systemProfile"
          >
          </ix-enclosure-disks>
        </div>

        <ng-template #mini>
          <div>
            <ix-enclosure-disks-mini
              *ngIf="events && systemState?.pools && systemState?.enclosureViews "
              [controller-events]="events"
              [current-tab]="currentView"
              [profile]="systemProfile"
            >
            </ix-enclosure-disks-mini>
          </div>
        </ng-template>
      </ng-container>
    </div>

    <!-- Enclosure Selector -->
    <div
      *ngIf="showEnclosureSelector && events && systemState && systemState.pools && systemState.enclosures && systemState.enclosures.length > 1 && supportedHardware"
      #navigation
      fxFlex="240px"
      fxFlex.lt-lg="180px"
      class="enclosure-selector"
    >
      <ng-container *ngFor="let enclosure of systemState.enclosureViews; let i = index">
        <div
          [class]="['enclosure', 'enclosure-'+ i]"
          [class.active]="enclosure.number === systemState.selectedEnclosure"
          (click)="selectEnclosure(enclosure.number)"
        >
          <div *ngIf="systemState.enclosures[enclosure.number].label === systemState.enclosures[enclosure.number].name">
            {{ enclosure.model }} ({{ i }})
          </div>
          <div *ngIf="systemState.enclosures[enclosure.number].label !== systemState.enclosures[enclosure.number].name">
            {{ systemState.enclosures[enclosure.number].label }} ({{ i }})
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="errors.length > 0">
  <div class="error mat-card">
    <h3 class="error-header">
      <ix-icon name="mdi-alert"></ix-icon>
      {{ errors[0].name }}
    </h3>

    <div class="error-message">
      {{ errors[0].message }}.
      <br />
      {{ 'Please visit our support page for help.' | translate }}
    </div>

    <div class="error-footer">
      <button
        mat-button
        color="primary"
        ixTest="contact-support"
        (click)="router.navigate(['/system/support'])"
      >
        {{ 'CONTACT SUPPORT' | translate }}
      </button>
    </div>
  </div>
</ng-container>
